<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>太巴塱國小附設幼兒園 - 阿美族語學習網</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- ★★★ 1. 引入 PDF 製作工具 (證書功能需要) ★★★ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23e5e7eb' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .text-amis-red { color: #E3002D; }
        .bg-amis-red { background-color: #E3002D; }
        
        .weaving-pattern {
            height: 24px;
            width: 100%;
            background-image: 
                linear-gradient(135deg, #000000 25%, transparent 25%), 
                linear-gradient(225deg, #000000 25%, transparent 25%), 
                linear-gradient(45deg, #000000 25%, transparent 25%), 
                linear-gradient(315deg, #000000 25%, transparent 25%);
            background-position: 12px 0, 12px 0, 0 0, 0 0;
            background-size: 24px 24px;
            background-repeat: repeat-x;
            background-color: #ffffff;
            opacity: 0.9;
        }

        .lesson-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .lesson-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .hero-pattern {
            background-color: #E3002D;
            background-image: radial-gradient(#ffffff 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* ★★★ 2. 證書樣式 (必須加入才能正常截圖) ★★★ */
        #certificate-template {
            width: 1123px; /* A4 橫向像素 */
            height: 794px;
            padding: 40px;
            background-color: #fff;
            background-image: url("https://www.transparenttextures.com/patterns/cream-paper.png");
            position: fixed; /* 隱藏在螢幕外 */
            top: -9999px;
            left: -9999px;
            font-family: 'Noto Sans TC', serif;
            text-align: center;
            color: #333;
            border: 20px solid #E3002D;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: -1;
        }
        
        .cert-border-inner {
            border: 5px solid #FBBF24;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .cert-stamp {
            position: absolute;
            bottom: 50px;
            left: 100px;
            width: 150px;
            height: 150px;
            border: 4px solid #E3002D;
            border-radius: 50%;
            color: #E3002D;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
            transform: rotate(-15deg);
            opacity: 0.8;
            border-style: double;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- 頂部導覽列 -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-12 h-12 bg-amis-red rounded-full flex items-center justify-center text-white font-bold text-2xl shadow-sm">T</div>
                <div class="flex flex-col">
                    <span class="text-xl font-bold text-gray-800 tracking-wide leading-tight">阿美族語學習網</span>
                    <span class="text-sm text-gray-500 font-medium">太巴塱國小附設幼兒園</span>
                </div>
            </div>
        </div>
        <div class="weaving-pattern"></div>
    </header>

    <!-- 歡迎橫幅 -->
    <div class="hero-pattern text-white py-12 md:py-16 px-4 relative overflow-hidden">
        <div class="max-w-4xl mx-auto text-center relative z-10">
            <h1 class="text-3xl md:text-5xl font-bold mb-4 drop-shadow-md">Nga'ay ho! 歡迎來到族語小教室</h1>
            <p class="text-lg md:text-xl opacity-90 mb-8">快樂學習，傳承文化</p>
            <div class="inline-block bg-white/20 backdrop-blur-sm px-6 py-2 rounded-full border border-white/30 text-sm font-bold">
                <i class="fa-regular fa-calendar-check mr-2"></i>114學年第1學期
            </div>
        </div>
        <!-- 裝飾背景圓 -->
        <div class="absolute top-0 left-0 w-64 h-64 bg-white opacity-10 rounded-full -translate-x-1/2 -translate-y-1/2 blur-3xl"></div>
        <div class="absolute bottom-0 right-0 w-96 h-96 bg-yellow-400 opacity-20 rounded-full translate-x-1/3 translate-y-1/3 blur-3xl"></div>
    </div>

    <!-- 主要內容區 -->
    <main class="flex-grow max-w-6xl mx-auto px-4 py-12 w-full">
        
        <!-- ★★★ 3. 我的成就區塊 (登入後才會顯示) ★★★ -->
        <div id="achievement-section" class="bg-white rounded-2xl p-8 shadow-lg border-l-8 border-yellow-400 mb-10 hidden">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="mb-4 md:mb-0">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">
                        <i class="fa-solid fa-medal text-yellow-500 mr-2"></i>學習成就中心
                    </h2>
                    <p class="text-gray-600">
                        你好，<span id="user-name-display" class="font-bold text-blue-600">同學</span>！
                        目前完成度：<span id="progress-text" class="font-bold">點擊按鈕檢查</span>
                    </p>
                </div>
                <button onclick="AuthSystem.checkAndDownloadCertificate()" class="bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600 text-white font-bold py-3 px-8 rounded-full shadow-md transform transition hover:scale-105 flex items-center gap-2">
                    <i class="fa-solid fa-file-pdf"></i>
                    領取結業證書
                </button>
            </div>
        </div>

        <!-- 課程列表容器 (由 JS 自動生成) -->
        <div id="lessons-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
            <div class="col-span-full text-center text-gray-500 py-10">
                <i class="fa-solid fa-spinner fa-spin text-3xl mb-3"></i>
                <p>正在載入課程...</p>
            </div>
        </div>

    </main>

    <!-- 頁尾 -->
    <footer class="bg-gray-800 text-gray-300 py-10 mt-auto">
        <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
            <div class="mb-6 md:mb-0 text-center md:text-left">
                <h4 class="text-white font-bold text-xl mb-2">太巴塱國民小學附設幼兒園</h4>
                <p class="text-sm opacity-80"><i class="fa-solid fa-location-dot mr-2"></i>花蓮縣光復鄉中正路二段23號</p>
                <p class="text-sm opacity-80 mt-1">傳承文化，快樂學習</p>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-xs text-gray-500 w-full md:w-auto md:border-t-0 md:mt-0">
                &copy; 2023 Tafalong Elementary School Preschool.
            </div>
        </div>
    </footer>

    <!-- ★★★ 4. 隱藏的證書 HTML 模板 ★★★ -->
    <div id="certificate-template">
        <div class="cert-border-inner">
            <!-- 裝飾花紋 -->
            <div class="absolute top-0 left-0 text-6xl text-red-600 opacity-20 p-4"><i class="fa-solid fa-sun"></i></div>
            <div class="absolute top-0 right-0 text-6xl text-red-600 opacity-20 p-4"><i class="fa-solid fa-sun"></i></div>
            <div class="absolute bottom-0 left-0 text-6xl text-red-600 opacity-20 p-4"><i class="fa-solid fa-mountain"></i></div>
            <div class="absolute bottom-0 right-0 text-6xl text-red-600 opacity-20 p-4"><i class="fa-solid fa-mountain"></i></div>

            <h1 class="text-6xl font-bold mb-8 text-red-700 tracking-widest">結業證書</h1>
            
            <p class="text-2xl mb-2 text-gray-600">茲證明學生</p>
            <h2 id="cert-student-name" class="text-5xl font-bold mb-6 border-b-2 border-gray-300 pb-2 px-10">王小明</h2>
            
            <p class="text-xl mb-8 max-w-2xl leading-loose">
                完成114學年度第1學期阿美族語學習網所有遊戲挑戰關卡，<br>
                成績優異，展現對阿美族文化之熱愛與傳承精神，<br>
                特頒此證，以資鼓勵。
            </p>

            <div class="mt-12 flex justify-between w-3/4 items-end">
                <div class="text-center">
                    <div class="cert-stamp">太巴塱國小<br>附設幼兒園</div>
                </div>
                <div class="text-center">
                    <p class="text-lg text-gray-500 mb-1">頒發日期</p>
                    <p id="cert-date" class="text-2xl font-bold">2023 年 12 月 25 日</p>
                </div>
                <div class="text-center">
                    <div class="w-32 h-1 border-b-2 border-black mb-2 mx-auto"></div>
                    <p class="text-xl font-bold">校長 劉從義</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!--          JAVASCRIPT 設定與邏輯區           -->
    <!-- ========================================== -->
    
    <!-- 先載入 Auth.js -->
    <script src="js/auth.js"></script>

    <script>
        // =================================================================
        // ★★★ 課程列表資料 (保留您的第15週) ★★★
        // =================================================================
        
        const websiteData = {
            lessons: [
                {
                    week: "第 16 週",
                    title: "尚未開放",
                    subtitle: "Coming Soon",
                    desc: "敬請期待下週的精彩課程內容！",
                    icon: "fa-lock",
                    color: "gray",
                    status: "lock",
                    link: "#"
                },
                {
                    week: "第 15 週",
                    title: "我們一起做什麼？",
                    subtitle: "Mimaan kita?",
                    desc: "要如何和好朋友說想要一起做什麼事情呢？",
                    icon: "fa-bolt", // fa-battery-bolt 某些版本可能不支援，換成 bolt 或 battery-full
                    color: "yellow",
                    status: "new",
                    link: "learning/learning_week15.html"
                },
                {
                    week: "第 14 週",
                    title: "這是什麼？",
                    subtitle: "O maan kinian?",
                    desc: "學習如何詢問物品名稱，以及認識帽子、衣服等生活用品。",
                    icon: "fa-shirt",
                    color: "orange",
                    status: "",
                    link: "learning/learning_week14.html"
                },
                {
                    week: "第 13 週",
                    title: "好吃的野菜",
                    subtitle: "Ka'soay a dateng",
                    desc: "孩子們到太巴塱文健站，和阿公、阿嬤一起享用好吃的haposay!",
                    icon: "fa-bowl-rice",
                    color: "green",
                    status: "",
                    link: "learning/learning_week13.html"
                },
                {
                    week: "第 12 週",
                    title: "我的部落",
                    subtitle: "I cowa ko niyaro' ako?",
                    desc: "我的部落在哪裡呢？太巴塱有什麼",
                    icon: "fa-child-reaching",
                    color: "blue",
                    status: "",
                    link: "#"
                }
            ]
        };

        // =================================================================
        // 負責產生卡片的函式
        // =================================================================

        function renderLessons() {
            const container = document.getElementById('lessons-container');
            if (!container) return;
            
            container.innerHTML = ''; // 清空目前內容

            websiteData.lessons.forEach(lesson => {
                // 定義顏色樣式
                const colors = {
                    red:    { bg: 'bg-red-500',    text: 'text-red-600',    light: 'bg-red-50',    border: 'border-red-200' },
                    orange: { bg: 'bg-orange-500', text: 'text-orange-600', light: 'bg-orange-50', border: 'border-orange-200' },
                    yellow: { bg: 'bg-yellow-500', text: 'text-yellow-600', light: 'bg-yellow-50', border: 'border-yellow-200' },
                    green:  { bg: 'bg-green-500',  text: 'text-green-600',  light: 'bg-green-50',  border: 'border-green-200' },
                    teal:   { bg: 'bg-teal-500',   text: 'text-teal-600',   light: 'bg-teal-50',   border: 'border-teal-200' },
                    blue:   { bg: 'bg-blue-500',   text: 'text-blue-600',   light: 'bg-blue-50',   border: 'border-blue-200' },
                    indigo: { bg: 'bg-indigo-500', text: 'text-indigo-600', light: 'bg-indigo-50', border: 'border-indigo-200' },
                    purple: { bg: 'bg-purple-500', text: 'text-purple-600', light: 'bg-purple-50', border: 'border-purple-200' },
                    pink:   { bg: 'bg-pink-500',   text: 'text-pink-600',   light: 'bg-pink-50',   border: 'border-pink-200' },
                    gray:   { bg: 'bg-gray-500',   text: 'text-gray-600',   light: 'bg-gray-50',   border: 'border-gray-200' }
                };
                
                const theme = colors[lesson.color] || colors.blue;
                
                let statusBadge = '';
                if (lesson.status === 'new') {
                    statusBadge = `<span class="absolute top-4 right-4 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-md shadow-sm animate-pulse">NEW</span>`;
                } else if (lesson.status === 'lock') {
                    statusBadge = `<span class="absolute top-4 right-4 bg-gray-400 text-white text-xs font-bold px-2 py-1 rounded-md shadow-sm"><i class="fa-solid fa-lock mr-1"></i>LOCKED</span>`;
                }

                const isLocked = lesson.status === 'lock';
                const linkAttr = isLocked ? 'javascript:void(0)' : `href="${lesson.link}"`;
                const cursorClass = isLocked ? 'cursor-not-allowed opacity-75 grayscale' : 'cursor-pointer';

                const html = `
                    <a ${linkAttr} class="lesson-card group relative bg-white rounded-2xl overflow-hidden shadow-md border border-gray-100 flex flex-col ${cursorClass}">
                        ${statusBadge}
                        <div class="h-32 ${theme.bg} relative overflow-hidden">
                             <div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(white 1px, transparent 1px); background-size: 10px 10px;"></div>
                             <div class="absolute -bottom-6 -right-6 text-white opacity-20 transform rotate-12 group-hover:scale-110 transition duration-500">
                                <i class="fa-solid ${lesson.icon} text-9xl"></i>
                             </div>
                             <div class="absolute bottom-4 left-6 text-white">
                                <span class="inline-block bg-white/20 backdrop-blur-md px-2 py-0.5 rounded text-xs font-bold mb-1 border border-white/20">${lesson.week}</span>
                                <h3 class="text-2xl font-bold tracking-wide">${lesson.title}</h3>
                             </div>
                        </div>
                        <div class="p-6 flex-grow flex flex-col">
                            <h4 class="text-sm font-bold text-gray-400 mb-2 uppercase tracking-wider">${lesson.subtitle}</h4>
                            <p class="text-gray-600 text-sm leading-relaxed mb-4 flex-grow">${lesson.desc}</p>
                            
                            <div class="mt-auto pt-4 border-t border-gray-100 flex justify-between items-center">
                                <span class="text-xs font-bold ${theme.text} bg-white px-2 py-1 rounded border ${theme.border}">
                                    <i class="fa-solid fa-book-open mr-1"></i> 開始學習
                                </span>
                                <div class="w-8 h-8 rounded-full ${theme.light} flex items-center justify-center ${theme.text} group-hover:translate-x-1 transition">
                                    <i class="fa-solid fa-arrow-right"></i>
                                </div>
                            </div>
                        </div>
                    </a>
                `;
                container.innerHTML += html;
            });
        }

        // =================================================================
        // 初始化與執行 (修正：使用 EventListener 確保順序正確)
        // =================================================================

        window.addEventListener('DOMContentLoaded', () => {
            // 1. 產生課程卡片
            renderLessons();

            // 2. 檢查會員狀態，顯示證書區塊
            // (我們檢查 window.AuthSystem 是否存在，避免報錯)
            if (typeof AuthSystem !== 'undefined' && AuthSystem.currentUser) {
                const section = document.getElementById('achievement-section');
                if (section) {
                    section.classList.remove('hidden');
                    const nameDisplay = document.getElementById('user-name-display');
                    if(nameDisplay) nameDisplay.innerText = AuthSystem.currentUser.name;
                }
            }
        });
    </script>
</body>
</html>




